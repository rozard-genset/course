{{ $image := "" }}

{{ if .Page.Params.Metadata.thumb  }}
    {{- $image = .Page.Resources.GetMatch .Page.Params.Metadata.thumb -}}
{{ end }}

{{ if .Page.Params.Module.Cover  }}
    {{- $image = .Page.Resources.GetMatch .Page.Params.Module.Cover -}}
{{ end }}


{{- if $image -}}
        {{- $imageOriginalWidth := $image.Width -}}
        {{- $sizes := slice 360 420 768 1024 1280 1536 -}}
        {{- $srcset := slice -}}
        {{- $sizestag := slice -}}

        {{- $thumb_start := $image.Resize "420x webp q100" -}}
 
        {{- range $sizes -}}
            {{- $thumb := $image.Resize (printf "%dx webp q100" .) -}}
            {{- $srcset = $srcset | append (printf ("%s %dw") $thumb.RelPermalink . ) -}}
            {{- $sizestag = $sizestag | append (printf ("(max-width: %dpx) ") . ) -}}
        {{- end -}}

        <img 
            fetchpriority="high"
            src="{{ $image.RelPermalink }}"
            alt="{{ .Title }}"
            class="rounded-2xl"
            width="{{ $thumb_start.Width }}"
            height="{{ $thumb_start.Height }}"
            title="{{ .Title }}"
            {{- if gt (len $srcset) 5 -}}
                {{- (printf " srcset=\"%s\"" (delimit $srcset ", "))   | safeHTMLAttr -}}
            {{- end -}}
        />

{{- end -}}